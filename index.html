<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>3D TOEIC単語ネットワーク</title>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        body {
            margin: 0;
            font-family: 'Segoe UI', 'Helvetica Neue', sans-serif;
            overflow: hidden;
            background: #000;
            touch-action: none;
        }

        #graph-container {
            width: 100vw;
            height: 100vh;
            touch-action: none;
        }

        .info-panel {
            position: fixed;
            top: auto; /* topを削除 */
            bottom: 20px; /* 下からの配置に変更 */
            right: 20px;
            left: 20px;
            background: rgba(28, 28, 45, 0.95);
            padding: 15px;
            border-radius: 15px;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            color: #fff;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 40vh; /* 画面の60%までの高さに制限 */
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
        }
/* モバイル用のメディアクエリを追加 */
@media (max-width: 768px) {
    .info-panel {
        bottom: 0; /* 画面下部にぴったり配置 */
        left: 0;
        right: 0;
        max-height: 40vh; /* モバイルではさらに小さく */
        border-radius: 15px 15px 0 0; /* 上部のみ角丸に */
        margin: 0; /* マージンを削除 */
    }
}
        .info-panel h2 {
            margin: 0 0 20px 0;
            color: #fff;
            font-size: 24px;
            font-weight: 600;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
        }

        .info-panel .meaning-box {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
        }

        .meaning-entry {
            margin-bottom: 12px;
            padding-bottom: 12px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .meaning-entry:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .part-of-speech {
            color: #4A90E2;
            font-weight: 600;
            margin-right: 8px;
        }

        .word-meaning {
            color: rgba(255, 255, 255, 0.9);
        }

        .info-panel .level-badge {
            display: inline-block;
            background: #4A90E2;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            margin-bottom: 15px;
        }

        .info-panel .example-box {
            border-left: 3px solid #4A90E2;
            padding: 10px 15px;
            margin: 15px 0;
            background: rgba(74, 144, 226, 0.1);
        }

        .info-panel .example-en {
            color: #fff;
            font-style: italic;
            margin-bottom: 8px;
            line-height: 1.4;
        }

        .info-panel .example-jp {
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9em;
            line-height: 1.4;
        }

        .info-panel .related-words {
            margin-top: 20px;
            padding-top: 15px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .info-panel .related-word-badge {
            display: inline-block;
            background: rgba(255, 255, 255, 0.15);
            padding: 4px 12px;
            border-radius: 15px;
            margin: 0 8px 8px 0;
            font-size: 12px;
            transition: background-color 0.3s;
            cursor: pointer;
        }

        .info-panel .related-word-badge:hover {
            background: rgba(255, 255, 255, 0.25);
        }

        .highlighted-word {
            color: #FFFFFF;
            padding: 3px 8px;
            margin: 0 2px;
            display: inline-block;
            position: relative;
            font-weight: 600;
            background: linear-gradient(135deg,
                    rgba(41, 121, 255, 0.3) 0%,
                    rgba(41, 121, 255, 0.4) 50%,
                    rgba(41, 121, 255, 0.3) 100%);
            border: 1px solid rgba(41, 121, 255, 0.4);
            border-radius: 4px;
            text-shadow:
                0 0 4px #fff,
                0 0 7px #fff,
                0 0 14px #2979FF,
                0 0 30px #2979FF,
                0 0 40px #2979FF;
            animation: soft-neon-flicker 4s infinite alternate;
        }

        .highlighted-word::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(41, 121, 255, 0.15);
            box-shadow:
                0 0 10px #fff,
                0 0 20px #2979FF,
                0 0 30px #2979FF;
            opacity: 0;
            animation: soft-neon-pulse 3s ease-in-out infinite;
            border-radius: 4px;
            z-index: -1;
        }

        @keyframes soft-neon-flicker {

            0%,
            18%,
            22%,
            25%,
            53%,
            57%,
            100% {
                text-shadow:
                    0 0 4px #fff,
                    0 0 7px #fff,
                    0 0 14px #2979FF,
                    0 0 30px #2979FF,
                    0 0 40px #2979FF;
            }

            20%,
            24%,
            55% {
                text-shadow:
                    0 0 2px #fff,
                    0 0 5px #fff,
                    0 0 10px #2979FF;
            }
        }

        @keyframes soft-neon-pulse {
            0% {
                opacity: 0.3;
            }

            50% {
                opacity: 0.7;
            }

            100% {
                opacity: 0.3;
            }
        }

        .highlighted-word:hover {
            animation: soft-neon-intense 0.5s ease-in-out infinite alternate;
            transform: scale(1.05);
            transition: transform 0.3s ease;
            background: linear-gradient(135deg,
                    rgba(41, 121, 255, 0.4) 0%,
                    rgba(41, 121, 255, 0.5) 50%,
                    rgba(41, 121, 255, 0.4) 100%);
        }

        @keyframes soft-neon-intense {
            from {
                text-shadow:
                    0 0 5px #fff,
                    0 0 10px #fff,
                    0 0 20px #2979FF,
                    0 0 35px #2979FF,
                    0 0 45px #2979FF;
            }

            to {
                text-shadow:
                    0 0 3px #fff,
                    0 0 7px #fff,
                    0 0 15px #2979FF,
                    0 0 25px #2979FF,
                    0 0 35px #2979FF;
            }
        }

        .word-category {
            font-size: 12px;
            color: rgba(255, 255, 255, 0.5);
            margin-bottom: 5px;
        }

        /* リンクのアニメーション用の新しいスタイル */
        .chain-link {
            animation: glowPulse 2s infinite;
        }

        @keyframes glowPulse {
            0% {
                filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.7));
            }

            50% {
                filter: drop-shadow(0 0 8px rgba(255, 255, 255, 0.9));
            }

            100% {
                filter: drop-shadow(0 0 2px rgba(255, 255, 255, 0.7));
            }
        }
        @media (max-width: 768px) {
            .info-panel h2 {
                font-size: 20px;
                margin-bottom: 15px;
            }
        
            .info-panel .meaning-box {
                padding: 10px;
                margin-bottom: 15px;
            }
        
            .meaning-entry {
                margin-bottom: 8px;
                padding-bottom: 8px;
            }
        
            .related-word-badge {
                padding: 3px 10px;
                margin: 0 6px 6px 0;
                font-size: 11px;
            }
        
            .example-box {
                padding: 8px 12px;
                margin: 12px 0;
            }
        }
        
        .scrollable {
            -webkit-overflow-scrolling: touch;
            overflow-y: auto;
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r134/three.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/dat-gui/0.7.9/dat.gui.min.js"></script>
    <script src="https://unpkg.com/three-spritetext"></script>
    <script src="https://unpkg.com/3d-force-graph"></script>
</head>

<body>
    <div id="graph-container"></div>
    <div id="info-panel" class="info-panel scrollable">
        <h2 id="word-title"></h2>
        <div id="level" class="level-badge"></div>
        <div class="word-category">関連情報</div>
        <div class="meaning-box">
            <div id="word-meaning"></div>
        </div>
        <div class="word-category">例文</div>
        <div class="example-box">
            <div id="word-example-en" class="example-en"></div>
            <div id="word-example-jp" class="example-jp"></div>
        </div>
        <div class="related-words">
            <div class="word-category">関連語</div>
            <div id="related-words-list"></div>
        </div>
    </div>


    <script>
        // vocabularyData.js
        const vocabularyData = {
            nodes: [
                // Group 1: ビジネス戦略
                {
                    id: "strategy",
                    label: "戦略",
                    group: 1,
                    meaning: "strategy (名詞): 戦略、計画\nstrategic (形容詞): 戦略的な\nstrategist (名詞): 戦略家",
                    exampleEn: "Our competitive strategy focuses on continuous innovation in global markets.",
                    exampleJp: "私たちの競争戦略は、継続的なイノベーションに焦点を当てています。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "innovation",
                    label: "革新",
                    group: 1,
                    meaning: "innovation (名詞): 革新\ninnovative (形容詞): 革新的な\ninnovator (名詞): 革新者",
                    exampleEn: "Our strategy promotes innovation to achieve sustainable growth in the market.",
                    exampleJp: "私たちの戦略は、持続可能な成長を達成するためにイノベーションを促進します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "growth",
                    label: "成長",
                    group: 1,
                    meaning: "growth (名詞): 成長、発展\ngrow (動詞): 成長する\ngrowing (形容詞): 成長している",
                    exampleEn: "The new initiative drives sustainable growth through continuous innovation.",
                    exampleJp: "新しいイニシアチブは、継続的なイノベーションを通じて持続可能な成長を推進します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "competitive",
                    label: "競争力のある",
                    group: 1,
                    meaning: "competitive (形容詞): 競争力のある\ncompete (動詞): 競争する\ncompetition (名詞): 競争",
                    exampleEn: "Our competitive strategy requires initiative to maintain market leadership.",
                    exampleJp: "私たちの競争戦略は、市場リーダーシップを維持するためのイニシアチブを必要とします。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "initiative",
                    label: "率先",
                    group: 1,
                    meaning: "initiative (名詞): 率先、主導権\ninitiate (動詞): 開始する\ninitiating (形容詞): 開始する",
                    exampleEn: "This growth initiative demonstrates our competitive advantage in the market.",
                    exampleJp: "この成長イニシアチブは、市場における私たちの競争優位性を示しています。",
                    level: "TOEIC 600-700"
                },

                // Group 2: プロジェクト管理
                {
                    id: "implementation",
                    label: "実施",
                    group: 2,
                    meaning: "implementation (名詞): 実施、実行\nimplement (動詞): 実施する\nimplementing (形容詞): 実施する",
                    exampleEn: "The implementation schedule requires timeline adjustments to ensure success.",
                    exampleJp: "実施スケジュールは、成功を確実にするためにタイムラインの調整が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "schedule",
                    label: "日程",
                    group: 2,
                    meaning: "schedule (名詞): 日程、予定表\nschedule (動詞): 予定を立てる\nscheduled (形容詞): 予定された",
                    exampleEn: "The monitoring schedule ensures implementation stays on track.",
                    exampleJp: "モニタリングスケジュールにより、実施が予定通りに進むことが確保されます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "monitoring",
                    label: "監視",
                    group: 2,
                    meaning: "monitoring (名詞): 監視、モニタリング\nmonitor (動詞): 監視する\nmonitored (形容詞): 監視された",
                    exampleEn: "Resource monitoring and schedule adjustments are essential for project success.",
                    exampleJp: "リソースのモニタリングとスケジュールの調整は、プロジェクトの成功に不可欠です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "timeline",
                    label: "時間軸",
                    group: 2,
                    meaning: "timeline (名詞): 時間軸、予定表\ntimed (形容詞): 時間を計った\ntiming (名詞): タイミング",
                    exampleEn: "The implementation timeline depends on available resource allocation.",
                    exampleJp: "実施のタイムラインは、利用可能なリソースの配分に依存します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "resource",
                    label: "資源",
                    group: 2,
                    meaning: "resource (名詞): 資源、リソース\nresourceful (形容詞): 工夫に富んだ\nresourcing (名詞): リソース配分",
                    exampleEn: "Effective resource management requires timeline monitoring and adjustments.",
                    exampleJp: "効果的なリソース管理には、タイムラインのモニタリングと調整が必要です。",
                    level: "TOEIC 600-700"
                },

                // Group 3: マーケティング
                {
                    id: "marketing",
                    label: "マーケティング",
                    group: 3,
                    meaning: "marketing (名詞): マーケティング\nmarket (動詞): 市場に出す\nmarketed (形容詞): 市場に出された",
                    exampleEn: "Our marketing campaign targets specific segments through strategic promotion.",
                    exampleJp: "私たちのマーケティングキャンペーンは、戦略的なプロモーションを通じて特定のセグメントをターゲットにしています。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "segment",
                    label: "セグメント",
                    group: 3,
                    meaning: "segment (名詞): 部分、区分\nsegment (動詞): 分割する\nsegmented (形容詞): 分割された",
                    exampleEn: "Market segment analysis guides our promotion and branding strategies.",
                    exampleJp: "市場セグメント分析が、プロモーションとブランディング戦略を導きます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "promotion",
                    label: "宣伝",
                    group: 3,
                    meaning: "promotion (名詞): 宣伝、昇進\npromote (動詞): 宣伝する、昇進させる\npromoted (形容詞): 宣伝された",
                    exampleEn: "Our promotion strategy enhances branding through targeted segment campaigns.",
                    exampleJp: "私たちのプロモーション戦略は、ターゲットセグメントのキャンペーンを通じてブランディングを強化します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "branding",
                    label: "ブランド構築",
                    group: 3,
                    meaning: "branding (名詞): ブランド構築\nbrand (動詞): ブランド化する\nbranded (形容詞): ブランド化された",
                    exampleEn: "Effective branding campaigns enhance our promotional activities.",
                    exampleJp: "効果的なブランディングキャンペーンは、プロモーション活動を強化します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "campaign",
                    label: "キャンペーン",
                    group: 3,
                    meaning: "campaign (名詞): キャンペーン\ncampaign (動詞): キャンペーンを行う",
                    exampleEn: "Our marketing campaign integrates branding across all channels.",
                    exampleJp: "私たちのマーケティングキャンペーンは、全チャネルでブランディングを統合します。",
                    level: "TOEIC 600-700"
                },

                // Group 4: 財務・会計
                {
                    id: "financial",
                    label: "財務の",
                    group: 4,
                    meaning: "financial (形容詞): 財務の、金融の\nfinance (動詞): 資金を提供する\nfinancing (名詞): 資金調達",
                    exampleEn: "The financial audit ensures compliance with accounting standards.",
                    exampleJp: "財務監査は、会計基準へのコンプライアンスを確保します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "audit",
                    label: "監査",
                    group: 4,
                    meaning: "audit (名詞): 監査\naudit (動詞): 監査する\naudited (形容詞): 監査された",
                    exampleEn: "The budget audit examines financial compliance in detail.",
                    exampleJp: "予算監査は、財務コンプライアンスを詳細に調査します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "budget",
                    label: "予算",
                    group: 4,
                    meaning: "budget (名詞): 予算\nbudget (動詞): 予算を立てる\nbudgetary (形容詞): 予算の",
                    exampleEn: "The investment budget requires careful audit review.",
                    exampleJp: "投資予算は慎重な監査レビューが必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "investment",
                    label: "投資",
                    group: 4,
                    meaning: "investment (名詞): 投資\ninvest (動詞): 投資する\ninvested (形容詞): 投資された",
                    exampleEn: "Our investment decisions ensure compliance with financial regulations.",
                    exampleJp: "私たちの投資判断は、財務規制へのコンプライアンスを確保します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "compliance",
                    label: "遵守",
                    group: 4,
                    meaning: "compliance (名詞): 遵守、順守\ncomply (動詞): 従う\ncompliant (形容詞): 遵守している",
                    exampleEn: "Financial compliance requires regular audit procedures.",
                    exampleJp: "財務コンプライアンスには定期的な監査手続きが必要です。",
                    level: "TOEIC 600-700"
                },
                // Group 5: 人事・組織
                {
                    id: "personnel",
                    label: "人事",
                    group: 5,
                    meaning: "personnel (名詞): 人事、職員\npersonal (形容詞): 個人の",
                    exampleEn: "The personnel department oversees training and evaluation processes.",
                    exampleJp: "人事部門は、研修と評価プロセスを監督しています。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "training",
                    label: "研修",
                    group: 5,
                    meaning: "training (名詞): 研修、訓練\ntrain (動詞): 訓練する\ntrained (形容詞): 訓練された",
                    exampleEn: "Our training program enhances development and performance metrics.",
                    exampleJp: "私たちの研修プログラムは、開発とパフォーマンス指標を向上させます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "development",
                    label: "開発",
                    group: 5,
                    meaning: "development (名詞): 開発、発展\ndevelop (動詞): 開発する\ndeveloped (形容詞): 開発された",
                    exampleEn: "Professional development influences performance and training outcomes.",
                    exampleJp: "専門能力開発は、パフォーマンスと研修成果に影響を与えます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "performance",
                    label: "業績",
                    group: 5,
                    meaning: "performance (名詞): 業績、実績\nperform (動詞): 実行する\nperforming (形容詞): 実行している",
                    exampleEn: "Regular performance evaluation guides employee development.",
                    exampleJp: "定期的なパフォーマンス評価が従業員の能力開発を導きます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "evaluation",
                    label: "評価",
                    group: 5,
                    meaning: "evaluation (名詞): 評価\nevaluate (動詞): 評価する\nevaluated (形容詞): 評価された",
                    exampleEn: "Personnel evaluation includes training assessment criteria.",
                    exampleJp: "人事評価には研修評価基準が含まれます。",
                    level: "TOEIC 600-700"
                },

                // Group 6: IT・テクノロジー
                {
                    id: "technology",
                    label: "技術",
                    group: 6,
                    meaning: "technology (名詞): 技術\ntechnological (形容詞): 技術的な\ntech (名詞): テクノロジー",
                    exampleEn: "New technology implementation requires robust security measures.",
                    exampleJp: "新技術の実装には、堅牢なセキュリティ対策が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "security",
                    label: "セキュリティ",
                    group: 6,
                    meaning: "security (名詞): セキュリティ、安全保障\nsecure (動詞): 安全を確保する\nsecured (形容詞): 保護された",
                    exampleEn: "Our security infrastructure protects critical system components.",
                    exampleJp: "私たちのセキュリティインフラは、重要なシステムコンポーネントを保護します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "infrastructure",
                    label: "インフラ",
                    group: 6,
                    meaning: "infrastructure (名詞): インフラ、基盤\ninfrastructural (形容詞): インフラの",
                    exampleEn: "The infrastructure integration enhances system optimization.",
                    exampleJp: "インフラの統合により、システムの最適化が強化されます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "integration",
                    label: "統合",
                    group: 6,
                    meaning: "integration (名詞): 統合\nintegrate (動詞): 統合する\nintegrated (形容詞): 統合された",
                    exampleEn: "System integration requires optimization of all components.",
                    exampleJp: "システム統合には、すべてのコンポーネントの最適化が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "optimization",
                    label: "最適化",
                    group: 6,
                    meaning: "optimization (名詞): 最適化\noptimize (動詞): 最適化する\noptimal (形容詞): 最適な",
                    exampleEn: "Technology optimization improves infrastructure efficiency.",
                    exampleJp: "技術の最適化により、インフラの効率性が向上します。",
                    level: "TOEIC 600-700"
                },

                // Group 7: コミュニケーション
                {
                    id: "communication",
                    label: "伝達",
                    group: 7,
                    meaning: "communication (名詞): 伝達、通信\ncommunicate (動詞): 伝達する\ncommunicative (形容詞): 話好きな",
                    exampleEn: "Effective communication enhances collaboration and negotiation processes.",
                    exampleJp: "効果的なコミュニケーションは、協力と交渉のプロセスを強化します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "collaboration",
                    label: "協力",
                    group: 7,
                    meaning: "collaboration (名詞): 協力、共同作業\ncollaborate (動詞): 協力する\ncollaborative (形容詞): 協力的な",
                    exampleEn: "Team collaboration improves coordination and communication.",
                    exampleJp: "チームの協力は、調整とコミュニケーションを改善します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "coordination",
                    label: "調整",
                    group: 7,
                    meaning: "coordination (名詞): 調整、連携\ncoordinate (動詞): 調整する\ncoordinated (形容詞): 調整された",
                    exampleEn: "Project coordination requires consultation and collaboration.",
                    exampleJp: "プロジェクトの調整には、協議と協力が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "consultation",
                    label: "協議",
                    group: 7,
                    meaning: "consultation (名詞): 協議、相談\nconsult (動詞): 相談する\nconsultative (形容詞): 助言的な",
                    exampleEn: "Regular consultation improves negotiation and coordination.",
                    exampleJp: "定期的な協議により、交渉と調整が改善されます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "negotiation",
                    label: "交渉",
                    group: 7,
                    meaning: "negotiation (名詞): 交渉\nnegotiate (動詞): 交渉する\nnegotiable (形容詞): 交渉可能な",
                    exampleEn: "Successful negotiation depends on clear communication and consultation.",
                    exampleJp: "成功する交渉は、明確なコミュニケーションと協議に依存します。",
                    level: "TOEIC 600-700"
                },

                // Group 8: リスク管理
                {
                    id: "risk",
                    label: "リスク",
                    group: 8,
                    meaning: "risk (名詞): リスク、危険\nrisky (形容詞): 危険な\nrisk (動詞): 危険を冒す",
                    exampleEn: "Risk assessment and contingency planning are essential for mitigation.",
                    exampleJp: "リスク評価と不測事態計画は、軽減のために不可欠です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "assessment",
                    label: "評価",
                    group: 8,
                    meaning: "assessment (名詞): 評価、査定\nassess (動詞): 評価する\nassessed (形容詞): 評価された",
                    exampleEn: "Risk assessment guides mitigation and prevention strategies.",
                    exampleJp: "リスク評価は、軽減と予防戦略を導きます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "mitigation",
                    label: "軽減",
                    group: 8,
                    meaning: "mitigation (名詞): 軽減\nmitigate (動詞): 軽減する\nmitigating (形容詞): 軽減する",
                    exampleEn: "Risk mitigation requires prevention and assessment measures.",
                    exampleJp: "リスク軽減には、予防と評価措置が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "prevention",
                    label: "予防",
                    group: 8,
                    meaning: "prevention (名詞): 予防\nprevent (動詞): 予防する\npreventive (形容詞): 予防の",
                    exampleEn: "Prevention strategies support contingency and mitigation plans.",
                    exampleJp: "予防戦略は、不測事態と軽減計画をサポートします。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "contingency",
                    label: "不測事態",
                    group: 8,
                    meaning: "contingency (名詞): 不測事態、偶発事象\ncontingent (形容詞): 偶発的な",
                    exampleEn: "Contingency planning incorporates risk assessment procedures.",
                    exampleJp: "不測事態計画には、リスク評価手順が組み込まれています。",
                    level: "TOEIC 600-700"
                },

                // Group 9: 品質管理
                {
                    id: "quality",
                    label: "品質",
                    group: 9,
                    meaning: "quality (名詞): 品質、質\nqualitative (形容詞): 質的な\nquality (形容詞): 高品質の",
                    exampleEn: "Quality standards ensure consistent satisfaction levels.",
                    exampleJp: "品質基準は、一貫した満足度レベルを確保します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "standard",
                    label: "基準",
                    group: 9,
                    meaning: "standard (名詞): 基準、標準\nstandardize (動詞): 標準化する\nstandardized (形容詞): 標準化された",
                    exampleEn: "Quality standards require regular inspection procedures.",
                    exampleJp: "品質基準には、定期的な検査手順が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "inspection",
                    label: "検査",
                    group: 9,
                    meaning: "inspection (名詞): 検査\ninspect (動詞): 検査する\ninspected (形容詞): 検査された",
                    exampleEn: "Regular inspection maintains assurance of quality standards.",
                    exampleJp: "定期的な検査により、品質基準の保証が維持されます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "assurance",
                    label: "保証",
                    group: 9,
                    meaning: "assurance (名詞): 保証、確約\nassure (動詞): 保証する\nassured (形容詞): 保証された",
                    exampleEn: "Quality assurance improves customer satisfaction levels.",
                    exampleJp: "品質保証は、顧客満足度レベルを向上させます。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "satisfaction",
                    label: "満足",
                    group: 9,
                    meaning: "satisfaction (名詞): 満足\nsatisfy (動詞): 満足させる\nsatisfactory (形容詞): 満足のいく",
                    exampleEn: "Customer satisfaction depends on quality standards maintenance.",
                    exampleJp: "顧客満足度は、品質基準の維持に依存します。",
                    level: "TOEIC 600-700"
                },

                // Group 10: サプライチェーン
                {
                    id: "supply",
                    label: "供給",
                    group: 10,
                    meaning: "supply (名詞): 供給\nsupply (動詞): 供給する\nsupplied (形容詞): 供給された",
                    exampleEn: "Supply chain logistics ensure efficient distribution processes.",
                    exampleJp: "サプライチェーンの物流は、効率的な配送プロセスを確保します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "logistics",
                    label: "物流",
                    group: 10,
                    meaning: "logistics (名詞): 物流\nlogistical (形容詞): 物流の",
                    exampleEn: "Logistics management optimizes distribution and inventory control.",
                    exampleJp: "物流管理は、配送と在庫管理を最適化します。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "distribution",
                    label: "配送",
                    group: 10,
                    meaning: "distribution (名詞): 配送、分配\ndistribute (動詞): 配送する\ndistributed (形容詞): 配送された",
                    exampleEn: "Efficient distribution requires inventory and procurement planning.",
                    exampleJp: "効率的な配送には、在庫と調達の計画が必要です。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "inventory",
                    label: "在庫",
                    group: 10,
                    meaning: "inventory (名詞): 在庫、棚卸し\ninventory (動詞): 棚卸しする",
                    exampleEn: "Inventory management supports procurement and distribution efficiency.",
                    exampleJp: "在庫管理は、調達と配送の効率性をサポートします。",
                    level: "TOEIC 600-700"
                },
                {
                    id: "procurement",
                    label: "調達",
                    group: 10,
                    meaning: "procurement (名詞): 調達\nprocure (動詞): 調達する\nprocured (形容詞): 調達された",
                    exampleEn: "Strategic procurement optimizes supply chain efficiency.",
                    exampleJp: "戦略的な調達は、サプライチェーンの効率性を最適化します。",
                    level: "TOEIC 600-700"
                }
            ],

            links: [
                // ビジネス戦略グループ
                {
                    source: "strategy",
                    target: "innovation",
                    value: 1
                },
                {
                    source: "innovation",
                    target: "growth",
                    value: 1
                },
                {
                    source: "growth",
                    target: "initiative",
                    value: 1
                },
                {
                    source: "competitive",
                    target: "strategy",
                    value: 1
                },
                {
                    source: "initiative",
                    target: "competitive",
                    value: 1
                },

                // プロジェクト管理グループ
                {
                    source: "implementation",
                    target: "schedule",
                    value: 1
                },
                {
                    source: "schedule",
                    target: "monitoring",
                    value: 1
                },
                {
                    source: "monitoring",
                    target: "resource",
                    value: 1
                },
                {
                    source: "timeline",
                    target: "implementation",
                    value: 1
                },
                {
                    source: "resource",
                    target: "timeline",
                    value: 1
                },

                // マーケティンググループ
                {
                    source: "marketing",
                    target: "segment",
                    value: 1
                },
                {
                    source: "segment",
                    target: "promotion",
                    value: 1
                },
                {
                    source: "promotion",
                    target: "branding",
                    value: 1
                },
                {
                    source: "branding",
                    target: "campaign",
                    value: 1
                },
                {
                    source: "campaign",
                    target: "marketing",
                    value: 1
                },

                // 財務・会計グループ
                {
                    source: "financial",
                    target: "audit",
                    value: 1
                },
                {
                    source: "audit",
                    target: "budget",
                    value: 1
                },
                {
                    source: "budget",
                    target: "investment",
                    value: 1
                },
                {
                    source: "investment",
                    target: "compliance",
                    value: 1
                },
                {
                    source: "compliance",
                    target: "financial",
                    value: 1
                },

                // 人事・組織グループ
                {
                    source: "personnel",
                    target: "training",
                    value: 1
                },
                {
                    source: "training",
                    target: "development",
                    value: 1
                },
                {
                    source: "development",
                    target: "performance",
                    value: 1
                },
                {
                    source: "performance",
                    target: "evaluation",
                    value: 1
                },
                {
                    source: "evaluation",
                    target: "personnel",
                    value: 1
                },

                // IT・テクノロジーグループ
                {
                    source: "technology",
                    target: "security",
                    value: 1
                },
                {
                    source: "security",
                    target: "infrastructure",
                    value: 1
                },
                {
                    source: "infrastructure",
                    target: "integration",
                    value: 1
                },
                {
                    source: "integration",
                    target: "optimization",
                    value: 1
                },
                {
                    source: "optimization",
                    target: "technology",
                    value: 1
                },

                // コミュニケーショングループ
                {
                    source: "communication",
                    target: "collaboration",
                    value: 1
                },
                {
                    source: "collaboration",
                    target: "coordination",
                    value: 1
                },
                {
                    source: "coordination",
                    target: "consultation",
                    value: 1
                },
                {
                    source: "consultation",
                    target: "negotiation",
                    value: 1
                },
                {
                    source: "negotiation",
                    target: "communication",
                    value: 1
                },

                // リスク管理グループ
                {
                    source: "risk",
                    target: "assessment",
                    value: 1
                },
                {
                    source: "assessment",
                    target: "mitigation",
                    value: 1
                },
                {
                    source: "mitigation",
                    target: "prevention",
                    value: 1
                },
                {
                    source: "prevention",
                    target: "contingency",
                    value: 1
                },
                {
                    source: "contingency",
                    target: "risk",
                    value: 1
                },

                // 品質管理グループ
                {
                    source: "quality",
                    target: "standard",
                    value: 1
                },
                {
                    source: "standard",
                    target: "inspection",
                    value: 1
                },
                {
                    source: "inspection",
                    target: "assurance",
                    value: 1
                },
                {
                    source: "assurance",
                    target: "satisfaction",
                    value: 1
                },
                {
                    source: "satisfaction",
                    target: "quality",
                    value: 1
                },

                // サプライチェーングループ
                {
                    source: "supply",
                    target: "logistics",
                    value: 1
                },
                {
                    source: "logistics",
                    target: "distribution",
                    value: 1
                },
                {
                    source: "distribution",
                    target: "inventory",
                    value: 1
                },
                {
                    source: "inventory",
                    target: "procurement",
                    value: 1
                },
                {
                    source: "procurement",
                    target: "supply",
                    value: 1
                }
            ]
        };

        document.addEventListener('touchmove', function(e) {
            if (!e.target.closest('.scrollable')) {
                e.preventDefault();
            }
        }, { passive: false });
        
        document.addEventListener('gesturestart', function(e) {
            e.preventDefault();
        });
        
        // デバイスチェック
        const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
        
        function calculateGroupCenter(nodes) {
            const positions = nodes.map(node => ({
                x: node.x || 0,
                y: node.y || 0,
                z: node.z || 0
            }));
        
            return {
                x: positions.reduce((sum, pos) => sum + pos.x, 0) / positions.length,
                y: positions.reduce((sum, pos) => sum + pos.y, 0) / positions.length,
                z: positions.reduce((sum, pos) => sum + pos.z, 0) / positions.length
            };
        }
        
        function calculateGroupCenter(nodes) {
            const positions = nodes.map(node => ({
                x: node.x || 0,
                y: node.y || 0,
                z: node.z || 0
            }));
        
            const center = {
                x: positions.reduce((sum, pos) => sum + pos.x, 0) / positions.length,
                y: positions.reduce((sum, pos) => sum + pos.y, 0) / positions.length,
                z: positions.reduce((sum, pos) => sum + pos.z, 0) / positions.length
            };
        
            // スマホの場合、中心点を上方向に移動
            if (isMobile) {
                center.y += 200; // この値を大きくすると、より上部に表示されます
            }
        
            return center;
        }
        
        function focusCameraOnGroup(nodes) {
            const center = calculateGroupCenter(nodes);
            const distance = isMobile ? 300 : 150;
            
            let cameraPosition = {
                x: center.x,
                y: center.y,
                z: center.z + distance
            };
        
            Graph.cameraPosition(
                cameraPosition,
                center,
                isMobile ? 1000 : 2000
            );
        }
        
        const Graph = ForceGraph3D()
            (document.getElementById('graph-container'))
            .graphData(vocabularyData)
            .nodeLabel('label')
            .nodeColor(node => getNodeColor(node.group))
            .nodeRelSize(isMobile ? 6 : 4)
            .linkWidth(1)
            .linkDirectionalParticles(isMobile ? 3 : 6)
            .linkDirectionalParticleWidth(2)
            .linkDirectionalParticleSpeed(0.003)
            .onNodeClick(handleNodeClick)
            .onBackgroundClick(hideInfoPanel);
        
        if (isMobile) {
            Graph
                .enableNodeDrag(false)
                .enableNavigationControls(true)
                .showNavInfo(false);
        }
        
        Graph.linkVisibility(() => false);
        
        Graph.nodeThreeObject(node => {
            const sprite = new SpriteText(node.id);
            sprite.material.depthWrite = false;
            sprite.color = 'white';
            sprite.textHeight = isMobile ? 10 : 8;
            return sprite;
        });
        
        function getNodeColor(group) {
            const colors = {
                1: '#4A90E2',
                2: '#50E3C2',
                3: '#F5A623'
            };
            return colors[group] || '#ffffff';
        }
        
        function getRelatedNodes(nodeId) {
            return vocabularyData.links
                .filter(link => link.source.id === nodeId || link.target.id === nodeId)
                .map(link => {
                    const relatedNode = link.source.id === nodeId ? link.target : link.source;
                    return {
                        id: relatedNode.id,
                        label: vocabularyData.nodes.find(n => n.id === relatedNode.id).label
                    };
                });
        }
        
        function createChainLinkGeometry(startPoint, endPoint) {
            const curve = new THREE.CatmullRomCurve3([
                new THREE.Vector3(startPoint.x, startPoint.y, startPoint.z),
                new THREE.Vector3(
                    (startPoint.x + endPoint.x) / 2,
                    (startPoint.y + endPoint.y) / 2 + 10,
                    (startPoint.z + endPoint.z) / 2
                ),
                new THREE.Vector3(endPoint.x, endPoint.y, endPoint.z)
            ]);
        
            const tubeGeometry = new THREE.TubeGeometry(curve, 64, 0.5, 8, false);
            return tubeGeometry;
        }
        
        const glowMaterial = new THREE.ShaderMaterial({
            uniforms: {
                time: { value: 0 },
                color: { value: new THREE.Color(0x00ffff) },
                glowIntensity: { value: 3 }
            },
            vertexShader: `
                varying vec2 vUv;
                void main() {
                    vUv = uv;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            fragmentShader: `
                uniform float time;
                uniform vec3 color;
                uniform float glowIntensity;
                varying vec2 vUv;
                
                void main() {
                    float pulse = 0.5 + 0.5 * sin(time * 2.0 + vUv.x * 10.0);
                    float edgeGlow = pow(1.0 - abs(vUv.y - 0.5) * 2.0, 2.0);
                    float shine = pow(max(0.0, sin(time * 3.0 + vUv.x * 15.0)), 8.0);
                    float brightness = mix(0.5, 1.0, pulse * edgeGlow + shine) * glowIntensity;
                    vec3 brightColor = color + vec3(0.3) * shine;
                    gl_FragColor = vec4(brightColor * brightness, 0.8);
                }
            `,
            transparent: true,
            blending: THREE.AdditiveBlending,
            depthWrite: false
        });
        
        Graph.linkThreeObject(link => {
            const start = link.source;
            const end = link.target;
            const geometry = createChainLinkGeometry(start, end);
        
            const material = glowMaterial.clone();
            material.uniforms.color.value = new THREE.Color(0x00BFFF);
            material.uniforms.glowIntensity.value = 1.5;
        
            const mesh = new THREE.Mesh(geometry, material);
            mesh.userData = { link };
        
            return mesh;
        });
        
        Graph.linkPositionUpdate((obj, { start, end }) => {
            if (obj.geometry) {
                const geometry = createChainLinkGeometry(start, end);
                obj.geometry.dispose();
                obj.geometry = geometry;
            }
            return false;
        });
        
        function highlightRelatedWords(text, relatedNodes) {
            let highlightedText = text;
            relatedNodes.forEach(node => {
                const regex = new RegExp(node.id, 'gi');
                highlightedText = highlightedText.replace(regex, `<span class="highlighted-word">${node.id}</span>`);
            });
            return highlightedText;
        }
        
        function handleNodeClick(node) {
            const infoPanel = document.getElementById('info-panel');
            document.getElementById('word-title').textContent = `${node.id} (${node.label})`;
        
            const meanings = node.meaning.split('\n').map(entry => {
                const [word, meaning] = entry.split(': ');
                const [mainWord, partOfSpeech] = word.split(' ');
                return `<div class="meaning-entry">
                    <span class="part-of-speech">${partOfSpeech}</span>
                    <span class="word-meaning">${mainWord}: ${meaning}</span>
                </div>`;
            }).join('');
        
            document.getElementById('word-meaning').innerHTML = meanings;
            document.getElementById('level').textContent = node.level;
        
            const relatedNodes = getRelatedNodes(node.id);
        
            document.getElementById('word-example-en').innerHTML =
                highlightRelatedWords(node.exampleEn, relatedNodes);
            document.getElementById('word-example-jp').textContent = node.exampleJp;
        
            const relatedWordsHtml = relatedNodes
                .map(related => `<span class="related-word-badge">${related.id} (${related.label})</span>`)
                .join('');
            document.getElementById('related-words-list').innerHTML = relatedWordsHtml;
        
            infoPanel.style.display = 'block';
        
            Graph.linkVisibility(link =>
                link.source.id === node.id || link.target.id === node.id
            );
        
            const connectedNodes = vocabularyData.links
                .filter(link => link.source.id === node.id || link.target.id === node.id)
                .map(link => link.source.id === node.id ? link.target : link.source);
        
            Graph.nodeColor(n =>
                n === node ? '#ff0000' :
                connectedNodes.includes(n) ? '#ffff00' :
                getNodeColor(n.group)
            );
        
            const nodeGroup = [node, ...connectedNodes];
            focusCameraOnGroup(nodeGroup);
        }
        
        function hideInfoPanel() {
            document.getElementById('info-panel').style.display = 'none';
            Graph
                .linkVisibility(() => false)
                .nodeColor(node => getNodeColor(node.group));
        }
        
        Graph.cameraPosition({ x: 0, y: 0, z: isMobile ? 600 : 200 });
        Graph.controls().enableDamping = true;
        Graph.controls().dampingFactor = 0.25;
        Graph.controls().rotateSpeed = 0.5;
        
        const ambientLight = new THREE.AmbientLight(0xffffff, 0.6);
        Graph.scene().add(ambientLight);
        
        const pointLight = new THREE.PointLight(0xffffff, 0.8, 100);
        pointLight.position.set(5, 5, 5);
        Graph.scene().add(pointLight);
        
        let particles;
        function initParticles() {
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            const particleCount = isMobile ? 500 : 1000;  // モバイルでは粒子数を減らす
            
            for (let i = 0; i < particleCount; i++) {
                vertices.push(
                    Math.random() * 600 - 300,
                    Math.random() * 600 - 300,
                    Math.random() * 600 - 300
                );
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({
                size: 0.5,
                color: 0xffffff,
                transparent: true,
                opacity: 0.5
            });
            particles = new THREE.Points(geometry, material);
            Graph.scene().add(particles);
        }
        
        initParticles();
        
        let time = 0;
        function animate() {
            time += 0.01;
        
            // モバイルの場合はエフェクトを軽減
            if (!isMobile || time % 2 === 0) {
                Graph.scene().traverse(obj => {
                    if (obj.material && obj.material.uniforms) {
                        obj.material.uniforms.time.value = time;
                        obj.material.uniforms.glowIntensity.value = 1.2 + Math.sin(time) * 0.3;
                    }
                });
        
                if (particles) {
                    particles.rotation.x += 0.0001;
                    particles.rotation.y += 0.0001;
                }
            }
        
            requestAnimationFrame(animate);
        }
        
        window.addEventListener('orientationchange', function() {
            setTimeout(() => {
                Graph.width(window.innerWidth);
                Graph.height(window.innerHeight);
            }, 100);
        });
        
        animate();
    </script>
</body>

</html>